var SubscribersList=[],SubscribersDataTable=$("#device-datatable").DataTable({data:SubscribersList,columns:[{title:"ID"},{title:"MSISDN"},{title:"IMSI"},{title:"IMEI"},{title:"NAM"}],paging:!0,pageLength:15,lengthMenu:[10,15,20,25,30,35,40,50,75,100],scrollCollapse:!0,info:!0,deferRender:!0,colReorder:!0,autofill:!0,searching:!0,responsive:!0,scrollX:!0,bPaginate:!1,bFilter:!1,bAutoWidth:!1,rowGroup:{dataSrc:4},columnDefs:[{targets:[0,1,2,3,4],className:"dt-center"},{visible:!1,targets:[4]}]});async function getSubscribersList(file){let myObject=await fetch(file),myText=await myObject.text();SubscribersList=JSON.parse(myText);for(let i=0;i<SubscribersList.length;i++)SubscribersList[i][0]="<form class='subscriber-info' method='POST'><input type='hidden' name='imsi' value="+SubscribersList[i][2]+"><button type='submit' class='button-table-data'>"+SubscribersList[i][0]+"</button></form>";SubscribersDataTable.clear(),SubscribersDataTable.rows.add(SubscribersList),SubscribersDataTable.draw(),SubscribersDataTable.responsive.recalc(),SubscribersDataTable.columns.adjust()}getSubscribersList("/hlr/ajax/subscribers/"),$(document).on("submit","#add-device-form",(function(e){e.preventDefault(),$.ajax({url:"/hlr/ajax/subscribers/add/",type:"POST",data:new FormData(this),xhr:function(){var xhr=new window.XMLHttpRequest;return xhr.upload.addEventListener("progress",(function(evt){evt.lengthComputable&&$("#add-device-form .button").html("<div class='loader'></div> ")})),xhr},success:function(data){"success"==data.status&&(notifier.success(data.message),getSubscribersList("/hlr/ajax/subscribers/")),"error"==data.status&&notifier.alert(data.message),$("#add-device-form .button").html("Register")},processData:!1,contentType:!1,cache:!1})})),$(document).on("submit","#remove-device-form",(function(e){e.preventDefault(),$.ajax({url:"/hlr/ajax/subscribers/remove/",type:"POST",data:new FormData(this),xhr:function(){var xhr=new window.XMLHttpRequest;return xhr.upload.addEventListener("progress",(function(evt){evt.lengthComputable&&$("#remove-device-form .button").html("<div class='loader'></div> ")})),xhr},success:function(data){console.log(data),"success"==data.status&&(notifier.info(data.message),getSubscribersList("/hlr/ajax/subscribers/")),"error"==data.status&&notifier.alert(data.message),$("#remove-device-form .button").html("Yes, I want to remove this subscriber")},processData:!1,contentType:!1,cache:!1})})),$(document).on("submit",".subscriber-info",(function(e){e.preventDefault(),$.ajax({url:"/hlr/ajax/subscribers/info/",type:"POST",data:new FormData(this),success:function(data){$("#subscriber-info-hider").hide(),$("#subscriber-info").show(),$("#subscriber-imei").val(""),$("#subscriber-nam").html(""),$("#subscriber-vlr").html(""),$("#subscriber-luoncs").html(""),$("#subscriber-2g option[value='none']").attr("selected",!0).siblings().attr("selected",!1).change(),$("#subscriber-2g").val("none").change(),$("#subscriber-2g").parents(".custom-select-wrapper").find(".custom-select-trigger").text("none"),$("#subscriber-2g").parents(".custom-select-wrapper").find(".custom-options span[data-value='none']").addClass("selection").siblings().removeClass("selection"),$("#subscriber-2g-ki").val(""),$("#subscriber-3g option[value='none']").attr("selected",!0).siblings().attr("selected",!1).change(),$("#subscriber-3g").val("none").change(),$("#subscriber-3g").parents(".custom-select-wrapper").find(".custom-select-trigger").text("none"),$("#subscriber-3g").parents(".custom-select-wrapper").find(".custom-options span[data-value='none']").addClass("selection").siblings().removeClass("selection"),$("#subscriber-3g-k").val(""),$("#subscriber-3g-op").val(""),$("#subscriber-3g-opc").val(""),$("#subscriber-3g-ind").html("");for(let i=0;i<data.length;i++)"ID"==data[i][0]&&$("#subscriber-id").html(data[i][1]),"MSISDN"==data[i][0]&&$("#subscriber-msisdn").val(data[i][1]),"IMSI"==data[i][0]&&($("#subscriber-imsi").html(data[i][1]),$("#subscriber-imsi-val").val(data[i][1])),"IMEI"==data[i][0]&&$("#subscriber-imei").val(data[i][1]),"NAM"==data[i][0]&&$("#subscriber-nam").html(data[i][1]),"VLRnumber"==data[i][0]&&$("#subscriber-vlr").html(data[i][1]),"lastLUseenonCS"==data[i][0]&&$("#subscriber-luoncs").html(moment(data[i][1]).format("YYYY-MM-DD HH:mm:ss")+"<br>"+data[i][2]),"2Gauth"==data[i][0]&&($("#subscriber-2g option[value="+data[i][1].toLowerCase()+"]").attr("selected",!0).siblings().attr("selected",!1).change(),$("#subscriber-2g").val(data[i][1].toLowerCase()).change(),$("#subscriber-2g").parents(".custom-select-wrapper").find(".custom-select-trigger").text(data[i][1].toLowerCase()),$("#subscriber-2g").parents(".custom-select-wrapper").find(".custom-options span[data-value="+data[i][1].toLowerCase()+"]").addClass("selection").siblings().removeClass("selection")),"KI"==data[i][0]&&$("#subscriber-2g-ki").val(data[i][1]),"3Gauth"==data[i][0]&&($("#subscriber-3g option[value="+data[i][1].toLowerCase()+"]").attr("selected",!0).siblings().attr("selected",!1).change(),$("#subscriber-3g").val(data[i][1].toLowerCase()).change(),$("#subscriber-3g").parents(".custom-select-wrapper").find(".custom-select-trigger").text(data[i][1].toLowerCase()),$("#subscriber-3g").parents(".custom-select-wrapper").find(".custom-options span[data-value="+data[i][1].toLowerCase()+"]").addClass("selection").siblings().removeClass("selection")),"K"==data[i][0]&&$("#subscriber-3g-k").val(data[i][1]),"OP"==data[i][0]&&($("#subscriber-3g-op").val(data[i][1]),$("#subscriber-3g-opc-box").hide()),"OPC"==data[i][0]&&($("#subscriber-3g-opc").val(data[i][1]),$("#subscriber-3g-op-box").hide()),"IND-bitlen"==data[i][0]&&$("#subscriber-3g-ind").html(data[i][1])},processData:!1,contentType:!1,cache:!1})})),$("#subscriber-2g").parents(".custom-select-wrapper").find(".custom-option").click((function(){"none"==$(this).text()?$("#subscriber-2g-ki-box").hide():$("#subscriber-2g-ki-box").show()})),$("#subscriber-2g").change((function(){"none"==$(this).val()?$("#subscriber-2g-ki-box").hide():$("#subscriber-2g-ki-box").show()})),$("#subscriber-3g").parents(".custom-select-wrapper").find(".custom-option").click((function(){"none"==$(this).text()?($("#subscriber-3g-k-box").hide(),$("#subscriber-3g-op-box").hide(),$("#subscriber-3g-opc-box").hide(),$("#subscriber-3g-ind-box").hide()):"xor"==$(this).text()?($("#subscriber-3g-k-box").show(),$("#subscriber-3g-op-box").hide(),$("#subscriber-3g-opc-box").hide(),$("#subscriber-3g-ind-box").show()):($("#subscriber-3g-k-box").show(),$("#subscriber-3g-op-box").show(),$("#subscriber-3g-opc-box").show(),$("#subscriber-3g-ind-box").show())})),$("#subscriber-3g").change((function(){"none"==$(this).val()?($("#subscriber-3g-k-box").hide(),$("#subscriber-3g-opc-box").hide(),$("#subscriber-3g-op-box").hide(),$("#subscriber-3g-ind-box").hide()):"xor"==$(this).val()?($("#subscriber-3g-k-box").show(),$("#subscriber-3g-op-box").hide(),$("#subscriber-3g-opc-box").hide(),$("#subscriber-3g-ind-box").show()):($("#subscriber-3g-k-box").show(),$("#subscriber-3g-op-box").show(),$("#subscriber-3g-opc-box").show(),$("#subscriber-3g-ind-box").show())})),$("#subscriber-3g-op").keyup((function(){""==$(this).val()?$("#subscriber-3g-opc-box").show():($("#subscriber-3g-opc-box").hide(),$("#subscriber-3g-opc").val(" "))})),$("#subscriber-3g-opc").keyup((function(){""==$(this).val()?$("#subscriber-3g-op-box").show():($("#subscriber-3g-op-box").hide(),$("#subscriber-3g-op").val(" "))})),$(document).on("submit","#subscriber-info-update-form",(function(e){e.preventDefault(),$.ajax({url:"/hlr/ajax/subscribers/update/",type:"POST",data:new FormData(this),xhr:function(){var xhr=new window.XMLHttpRequest;return xhr.upload.addEventListener("progress",(function(evt){evt.lengthComputable&&$("#subscriber-info-update-form .button").html("<div class='loader'></div> ")})),xhr},success:function(data){"success"==data.status&&(notifier.success(data.message),getSubscribersList("/hlr/ajax/subscribers/")),"error"==data.status&&notifier.alert(data.message),$("#subscriber-info-update-form .button").html("Update")},processData:!1,contentType:!1,cache:!1})}));